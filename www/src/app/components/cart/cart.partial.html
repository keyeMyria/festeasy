<loading-indicator data="cart && cartProducts" error="error"></loading-indicator>
<div class="ui centered grid" ng-show="cart && cartProducts && !cartProducts.length">
	<div class="ui column center aligned">
		<p>Your cart is empty</p>
		<button class="ui button" ui-sref="base.store.products">
			Continue shopping
		</button>
	</div>
</div>
<div ng-show="cart && cartProducts.length" class="ui segment">
	<p class="lead">Select festival:</p>
	<ui-select ng-model="selectedFestival" on-select="updateSelectedFestival($item, $model)">
	    <ui-select-match placeholder="Select a festival">
	        <span ng-bind="$select.selected.name + ' ' + ($select.selected.starts_on | date: 'yyyy')"></span>
	    </ui-select-match>
	    <ui-select-choices repeat="festival in (festivals | filter: $select.search) track by festival.id">
	        <span ng-bind="festival.name + ' ' + (festival.starts_on | date: 'yyyy')"></span>
	    </ui-select-choices>
	</ui-select>
	<br/>
	<div ng-show="selectedFestival">
		<p>Starts: {{selectedFestival.starts_on | date: "EEEE, d MMMM yyyy"}}</p>
		<p>Ends: {{selectedFestival.ends_on | date: "EEEE, d MMMM yyyy"}}</p>
		<br/>
	</div>
	<table class="ui selectable celled table">
		<thead>
			<th>Item Description</th>
			<th>Quantity</th>
			<th>Unit Price</th>
			<th>Sub Total</th>
			<th>Remove</th>
		</thead>
		<tbody>
			<tr ng-repeat="cartProduct in cartProducts">
				<td>
					<a
						ui-sref="base.store.product({productId: cartProduct.product.id})"
						ui-sref-opts="{inherit: false}">
						{{cartProduct.product.name}}
					</a>
				</td>
				<td>
					<input max="20" min="1" type="number" ng-model="cartProduct.quantity">
				</td>
				<td><rands amount-rands="cartProduct.product.price_rands"></rands></td>
				<td><rands amount-rands="cartProduct.sub_total_rands"></rands></td>
				<td><button class="ui button" ng-click="removeCartProduct(cartProduct)">Remove</button></td>
			</tr>
		</tbody>
	</table>
	<p>
		Total: <rands amount-rands="cart.total_rands"></rands>
	</p>
	<button ng-click="updateCartProducts(cartProducts)" class="ui button">Update</button>
	<button ng-click="checkout()" class="ui button">Secure Checkout</button>
</div>
